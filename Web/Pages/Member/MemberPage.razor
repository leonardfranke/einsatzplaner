@page "/{departmentUrl}/member"
@using BlazorBootstrap
@using Web.Extensions
@inherits MemberPageBase

<MudTable Loading="IsMembersLoading" @ref="Table" Items="Members" Breakpoint="Breakpoint.None" EditTrigger="TableEditTrigger.EditButton" CanCancelEdit="true" 
        RowEditCancel="EditCancel" RowEditPreview="CreateEditPreview" RowEditCommit="UpdateMember">
    <ToolBarContent>
        <MudText Typo="Typo.h6">Mitglieder</MudText>
        <MudSpacer/>
        <MudIconButton Variant="Variant.Outlined" Icon="@Icons.Material.Outlined.Add" OnClick="AddDummyMember"/>
    </ToolBarContent>
    <ColGroup>
        <col />
        <col />
        <col style="width:1%"/>
    </ColGroup>
    <HeaderContent>
        <MudTh>Name</MudTh>
        <MudTh>Administrator</MudTh>
        <MudTh></MudTh>
    </HeaderContent>
    <RowTemplate>
        <MudTd>@context.GetMemberName()</MudTd>
        <MudTd><MudCheckBox Disabled Value="context.IsAdmin"/></MudTd>
        <MudTd></MudTd>
    </RowTemplate>
    <RowEditingTemplate>
        @if(context.IsDummy)
        {
            <MudTd><MudTextField @bind-Value="context.Name"/></MudTd>
            <MudTd><MudCheckBox Disabled Value="context.IsAdmin" /></MudTd>
        }
        else
        {
            <MudTd>@context.Name</MudTd>
            <MudTd><MudCheckBox @bind-Value="context.IsAdmin" /></MudTd>
        }
        <MudTd><MudIconButton Icon="@Icons.Material.Outlined.Delete" Size="Size.Small" OnClick="() => DeleteMember(context)" /></MudTd>
    </RowEditingTemplate>
</MudTable>

<MudDataGrid Items="MembershipRequests" Class="mt-5">
    <NoRecordsContent>
        Keine Anfragen
    </NoRecordsContent>
    <ToolBarContent>
        <MudText Typo="Typo.h6">Beitrittsanfragen</MudText>
    </ToolBarContent>
    <Columns>
        <PropertyColumn Property="request => request.UserName" Title="Name"/>
        <TemplateColumn>
            <CellTemplate>
                <MudButtonGroup Variant="Variant.Outlined">
                    <MudIconButton Icon="@Icons.Material.Filled.Check" OnClick="() => AnswerRequest(context.Item.Id, true)"></MudIconButton>
                    <MudIconButton Icon="@Icons.Material.Filled.Delete" OnClick="() => AnswerRequest(context.Item.Id, false)"></MudIconButton>
                </MudButtonGroup>
            </CellTemplate>
        </TemplateColumn>
    </Columns>
</MudDataGrid>