@using BlazorBootstrap
@using Web.Extensions
@using Web.Models
@inherits RoleViewBase

@if(IsViewLoading)
{
    <div class="text-center">
        <div class="spinner-border m-5"></div>
    </div>
    return;
}

<h3>Rollen:</h3>

@foreach (var role in Roles)
{
    <MudDataGrid Items="role.MemberIds" Dense>
        <ToolBarContent>
            <MudText Typo="Typo.h5">@GetRoleHeader(role)</MudText>
            <MudSpacer />
            <MudText>Sperrzeitraum: @role.LockingPeriod Tage</MudText>
            <MudSpacer />
            <MudButtonGroup Variant="Variant.Outlined">
                <MudIconButton Icon="@Icons.Material.Outlined.Edit" OnClick="() => EditOrCreateRole(role)" />
                <MudIconButton Icon="@Icons.Material.Outlined.Person" OnClick="() => EditRoleMembers(role)" />
                <MudIconButton Icon="@Icons.Material.Outlined.ContentPaste" OnClick="() => EditOrCreateQualification(role, null)" />
            </MudButtonGroup>
        </ToolBarContent>
        <Columns>
            <PropertyColumn Property="memberId => GetMemberNameById(memberId)" Sortable="true" Title="Name">

            </PropertyColumn>
        </Columns>
        <NoRecordsContent>
            Keine Mitglieder in Rolle
        </NoRecordsContent>
    </MudDataGrid>

    @foreach (var qualification in GetQualificationsOfRole(role.Id))
    {
        <div class="mb-5" />

        <MudDataGrid Items="qualification.MemberIds" Dense>
            <ToolBarContent>
                <MudText Typo="Typo.h6">@qualification.Name</MudText>
                <MudSpacer />
                <MudButtonGroup Variant="Variant.Outlined">
                    <MudIconButton Icon="@Icons.Material.Outlined.Edit" OnClick="() => EditOrCreateQualification(role, qualification)" />
                    <MudIconButton Icon="@Icons.Material.Outlined.Person" OnClick="() => EditQualificationMembers(qualification)" />
                </MudButtonGroup>
            </ToolBarContent>
            <Columns>
                <PropertyColumn Property="memberId => GetMemberNameById(memberId)" Sortable="true" Title="Name">

                </PropertyColumn>
            </Columns>
            <NoRecordsContent>
                Keine Mitglieder in Qualifikation
            </NoRecordsContent>
        </MudDataGrid>
    }

    <div class="mb-10"/>
}

<br />
<button class="btn btn-primary" @onclick="() => EditOrCreateRole(null)">Rolle hinzufügen</button>

<div class="my-5" />

<h3>Bedarfsgruppen:</h3>
@if (RequirementGroups?.Count > 0)
{
    <div class="table-responsive">
        <table class="table">
            <thead>
                <tr>
                    <th scope="col">Bedarf</th>
                    <th scope="col" />
                </tr>
            </thead>
            <tbody>
                @foreach (var (group, index) in RequirementGroups.Select((group, index) => (group, index)))
                {
                    <tr @onmouseenter="() => HoveredId = group.Id" @onmouseleave="() => HoveredId = null">
                        <td>
                            @group.GetRequirementGroupDisplayText(Roles, Qualifications)
                        </td>
                        <td>
                            <button @onclick="() => EditOrCreateRequirementGroup(group)"
                                    class="btn btn-outline-dark"
                                    style="visibility: @(HoveredId == group.Id ? "visible" : "hidden")">
                                <i class="bi bi-pencil"></i>
                            </button>
                        </td>
                    </tr>
                }
            </tbody>
        </table>
    </div>
}

<br/>
<button class="btn btn-primary" @onclick="() => EditOrCreateRequirementGroup(null)">Bedarfsgruppe hinzufügen</button>

<div class="mb-5"/>